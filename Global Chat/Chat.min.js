javascript:(()=>{if(window.blooketChatLoaded)return;window.blooketChatLoaded=true;const username=prompt("Username?")||"Guest",roomList=["server1","server2","server3"];let currentRoom="server1";const ttl=18e5,connections={},channels={},colors={},userId=Math.random().toString(36).slice(2,7),sound=new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");const getColor=u=>colors[u]||(colors[u]=`hsl(${Math.random()*360},80%,55%)`);const ui=document.createElement("div");ui.innerHTML=`<div id=hdr>Blooket LAN Chat<br><small>Made by Tony-the-best on GitHub</small><span id=cls>âœ•</span></div><div id=stat>ðŸŸ¡ Connecting...</div><div id=rooms>${roomList.map((r,i)=>`<button data-room=${r} class=${i==0?"on":""}>Server ${i+1}</button>`).join("")}</div><div id=msgs></div><div id=bar><input id=inp placeholder="Type..." /><button id=send>Send</button></div>`;document.body.appendChild(ui);const style=document.createElement("style");style.textContent="#hdr{background:#2d8cff;color:#fff;padding:8px;font-weight:900;cursor:move}#hdr small{font-size:10px}#cls{float:right;cursor:pointer}#rooms button{background:#7a3cff;color:#fff;border:0;margin:2px}#rooms .on{background:#a56bff}#msgs{flex:1;overflow:auto;background:#dbeaff;padding:6px}#bar{display:flex}#inp{flex:1}div{font-family:sans-serif}";document.head.appendChild(style);Object.assign(ui.style,{position:"fixed",top:"60px",left:"60px",width:"360px",height:"520px",display:"flex",flexDirection:"column",zIndex:999999,border:"3px solid #000",borderRadius:"12px",background:"#fff"});let drag=false,dx=0,dy=0;ui.querySelector("#hdr").onmousedown=e=>{drag=true;dx=e.clientX-ui.offsetLeft;dy=e.clientY-ui.offsetTop};document.onmousemove=e=>drag&&(ui.style.left=e.clientX-dx+"px",ui.style.top=e.clientY-dy+"px");document.onmouseup=()=>drag=false;const msgs=ui.querySelector("#msgs"),input=ui.querySelector("#inp");ui.querySelectorAll("#rooms button").forEach(b=>b.onclick=()=>{ui.querySelectorAll("#rooms button").forEach(x=>x.classList.remove("on"));b.classList.add("on");currentRoom=b.dataset.room;msgs.innerHTML=""});const show=m=>{if(Date.now()-m.time>ttl||m.room!==currentRoom)return;const d=document.createElement("div");d.innerHTML=`<b style=color:${getColor(m.user)}>${m.user}</b>: ${m.text}`;msgs.appendChild(d);msgs.scrollTop=1e9;sound.play()};const broadcast=m=>{show(m);Object.values(channels).forEach(c=>c.readyState==="open"&&c.send(JSON.stringify(m)))};const socket=new WebSocket("wss://blooket-lan-chat-signaling.glitch.me");socket.onopen=()=>{ui.querySelector("#stat").textContent="ðŸŸ¢ Online";socket.send(JSON.stringify({join:userId}))};socket.onmessage=async e=>{const d=JSON.parse(e.data);if(d.from===userId)return;if(d.offer){const pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});connections[d.from]=pc;pc.ondatachannel=ev=>channels[d.from]=ev.channel;await pc.setRemoteDescription(d.offer);const ans=await pc.createAnswer();await pc.setLocalDescription(ans);socket.send(JSON.stringify({answer:ans,to:d.from,from:userId}))}if(d.answer)await connections[d.from]?.setRemoteDescription(d.answer)};const pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),dc=pc.createDataChannel("chat");channels[userId]=dc;dc.onmessage=e=>show(JSON.parse(e.data));pc.onicecandidate=e=>e.candidate&&socket.send(JSON.stringify({ice:e.candidate,from:userId}));pc.createOffer().then(o=>pc.setLocalDescription(o).then(()=>socket.send(JSON.stringify({offer:o,from:userId}))));ui.querySelector("#send").onclick=()=>input.value&&(broadcast({user:username,text:input.value,time:Date.now(),room:currentRoom}),input.value="");input.onkeydown=e=>e.key==="Enter"&&ui.querySelector("#send").click();ui.querySelector("#cls").onclick=()=>ui.remove();})();
