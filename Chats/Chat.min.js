javascript:(()=>{if(window.__BLOOKET_LAN_CHAT__)return;window.__BLOOKET_LAN_CHAT__=true;const TTL=1800000,user=prompt("Username?")||"Guest";let room="server1",pcs={},dcs={};const chatBox=document.createElement("div");chatBox.id="chatBox";chatBox.innerHTML=`<div id="header">Blooket LAN Chat <span id="close">âœ•</span></div><div id="rooms"><button data-r="server1" class="on">Server 1</button><button data-r="server2">Server 2</button><button data-r="server3">Server 3</button></div><div id="msgs"></div><div style="display:flex"><input id="inp" placeholder="Type message..." /><button id="sendBtn">Send</button></div>`;document.body.appendChild(chatBox);const css=document.createElement("style");css.textContent="#chatBox{position:fixed;top:50px;left:50px;width:90%;max-width:420px;height:60%;max-height:520px;background:linear-gradient(180deg,#4a90e2,#357ABD);border:3px solid #333;border-radius:12px;display:flex;flex-direction:column;box-shadow:0 5px 20px rgba(0,0,0,0.3);z-index:999999;font-family:sans-serif;}#header{padding:12px;background:#357ABD;cursor:move;display:flex;justify-content:space-between;font-weight:bold;border-radius:9px 9px 0 0;color:#fff;touch-action:none;}#rooms{display:flex;justify-content:space-between;margin:4px;}#rooms button{margin:2px;background:#6a0dad;color:#fff;border:none;cursor:pointer;border-radius:6px;flex:1;}#rooms .on{background:#9b30ff;color:#fff;}#msgs{flex:1;padding:8px;overflow-y:auto;font-size:13px;background:#cce0ff;border-top:2px solid #333;border-bottom:2px solid #333;}#inp{flex:1;border:none;padding:10px;outline:none;border-top:1px solid #333;background:#e6f0ff;}#sendBtn{padding:10px;background:#9b30ff;color:#fff;border:none;border-radius:0 0 9px 9px;cursor:pointer;}button{cursor:pointer;border-radius:6px;padding:6px;font-weight:bold;}";document.head.appendChild(css);const header=document.getElementById("header"),msgs=document.getElementById("msgs"),inp=document.getElementById("inp"),sendBtn=document.getElementById("sendBtn");let drag=false,ox,oy;function startDrag(x,y){drag=true;ox=x-chatBox.offsetLeft;oy=y-chatBox.offsetTop}function moveDrag(x,y){if(drag){chatBox.style.left=x-ox+"px";chatBox.style.top=y-oy+"px"}}function endDrag(){drag=false}header.addEventListener("mousedown",e=>startDrag(e.clientX,e.clientY));document.addEventListener("mousemove",e=>moveDrag(e.clientX,e.clientY));document.addEventListener("mouseup",endDrag);header.addEventListener("touchstart",e=>{e.preventDefault();const t=e.touches[0];startDrag(t.clientX,t.clientY)});document.addEventListener("touchmove",e=>{const t=e.touches[0];moveDrag(t.clientX,t.clientY)});document.addEventListener("touchend",endDrag);document.querySelectorAll("#rooms button").forEach(b=>{b.onclick=()=>{document.querySelectorAll("#rooms button").forEach(x=>x.classList.remove("on"));b.classList.add("on");room=b.dataset.r;msgs.innerHTML=""}});function show(m){if(Date.now()-m.t>TTL||m.room!==room)return;const d=document.createElement("div");d.textContent=`[${m.u}] ${m.m}`;msgs.appendChild(d);msgs.scrollTop=msgs.scrollHeight}function send(m){show(m);for(const id in dcs){const dc=dcs[id];if(dc.readyState==="open")dc.send(JSON.stringify(m))}}const SIGNAL_SERVER="wss://blooket-lan-chat-signaling.glitch.me",ws=new WebSocket(SIGNAL_SERVER),peerId=Math.random().toString(36).substring(2,8);ws.onopen=()=>ws.send(JSON.stringify({type:"join",id:peerId}));ws.onmessage=async e=>{const msg=JSON.parse(e.data);if(msg.from===peerId)return;if(msg.type==="offer"){const pc=new RTCPeerConnection();pcs[msg.from]=pc;pc.ondatachannel=ev=>{dcs[msg.from]=ev.channel;ev.channel.onmessage=f=>show(JSON.parse(f.data))};await pc.setRemoteDescription(new RTCSessionDescription(msg.offer));const answer=await pc.createAnswer();await pc.setLocalDescription(answer);ws.send(JSON.stringify({type:"answer",answer,from:peerId,to:msg.from}))}else if(msg.type==="answer"){const pc=pcs[msg.from];if(!pc)return;await pc.setRemoteDescription(new RTCSessionDescription(msg.answer))}};const pc=new RTCPeerConnection(),dc=pc.createDataChannel("chat");dcs["self"]=dc;pcs["self"]=pc;dc.onmessage=e=>show(JSON.parse(e.data));pc.onicecandidate=e=>{if(e.candidate)ws.send(JSON.stringify({type:"ice",candidate:e.candidate,from:peerId}))};pc.createOffer().then(offer=>pc.setLocalDescription(offer).then(()=>ws.send(JSON.stringify({type:"offer",offer,from:peerId}))));function sendInput(){if(!inp.value)return;send({u:user,m:inp.value,t:Date.now(),room});inp.value=""}inp.addEventListener("keydown",e=>{if(e.key==="Enter")sendInput()});sendBtn.addEventListener("click",sendInput);document.getElementById("close").onclick=()=>chatBox.remove();})();
